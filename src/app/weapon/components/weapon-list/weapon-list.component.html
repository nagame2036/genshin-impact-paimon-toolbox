<div class="options">
  <app-select class="option" [options]="service.sorts" [value]="service.sort" (changed)="changeSort($event)">
    <span form-label>
      {{ i18n.dict('sort') | translate }}
    </span>
  </app-select>
  <app-multi-select class="option" [options]="service.rarities" [values]="service.rarityFilter"
                    (changed)="filterRarity($event)">
    <span form-label>
      {{ i18n.dict('rarity') | translate }}
    </span>
  </app-multi-select>
  <app-multi-select class="option" [options]="service.types" [values]="service.typeFilter"
                    (changed)="filterType($event)">
    <span form-label>
      {{ i18n.dict('weapon') | translate }}
    </span>
  </app-multi-select>
  <div class="actions">
    <app-ring-button class="add-btn" (clicked)="add.emit($event)">
      {{ i18n.module('add') | translate }}
    </app-ring-button>
    <ng-content select="[actions]"></ng-content>
  </div>
</div>
<div class="list">
  <div *ngFor="let item of items; trackBy: trackItem" class="overview" [class.selected]="selectedItems.includes(item)"
       (click)="select(item)">
    <app-item-view category="weapons" [id]="item.info.id" [rarity]="item.info.rarity"></app-item-view>
    <img class="weapon-type-hint" [src]="images.get('weapon-types', item.info.type)"
         [alt]="i18n.dict('weapon-types.' + item.info.type) | translate">
    <div class="item-overview">
      <div>
        <b>{{ i18n.dict('refine-rank') | translate }}</b>
      </div>
      <div class="col-span-3">
        {{ item.progress.refine }}
      </div>
      <div class="item-overview-odd">
        <b>{{ i18n.dict('ascension') | translate }}</b>
      </div>
      <div class="item-overview-odd" [class.col-span-3]="item.progress.ascension >= item.plan.ascension">
        ★{{ item.progress.ascension }}
      </div>
      <ng-container *ngIf="item.progress.ascension < item.plan.ascension">
        <div class="item-overview-odd">
          →
        </div>
        <div class="item-overview-odd">
          ★{{ item.plan.ascension }}
        </div>
      </ng-container>
      <div>
        <b>{{ i18n.dict('level') | translate }}</b>
      </div>
      <div [class.col-span-3]="item.progress.level >= item.plan.level">
        {{ item.progress.level }}
      </div>
      <ng-container *ngIf="item.progress.level < item.plan.level">
        <div>
          →
        </div>
        <div>
          {{ item.plan.level }}
        </div>
      </ng-container>
      <ng-container *ngFor="let type of service.getStatsTypes(item); let i = index">
        <div [class.item-overview-odd]="i % 2 == 0">
          <b>{{ i18n.stats(type) | translate }}</b>
        </div>
        <ng-container *ngIf="type.endsWith('%') else numeric">
          <div [class.item-overview-odd]="i % 2 == 0"
               [class.col-span-3]="item.currentStats.get(type) >= item.planStats.get(type)">
            {{ item.currentStats.get(type) | percent: '1.0-1' }}
          </div>
          <ng-container *ngIf="item.currentStats.get(type) < item.planStats.get(type)">
            <div [class.item-overview-odd]="i % 2 == 0">
              →
            </div>
            <div [class.item-overview-odd]="i % 2 == 0">
              {{ item.planStats.get(type) | percent: '1.0-1' }}
            </div>
          </ng-container>
        </ng-container>
        <ng-template #numeric>
          <div [class.item-overview-odd]="i % 2 == 0"
               [class.col-span-3]="item.currentStats.get(type) >= item.planStats.get(type)">
            {{ item.currentStats.get(type) | number: '1.0-0' }}
          </div>
          <ng-container *ngIf="item.currentStats.get(type) < item.planStats.get(type)">
            <div [class.item-overview-odd]="i % 2 == 0">
              →
            </div>
            <div [class.item-overview-odd]="i % 2 == 0">
              {{ item.planStats.get(type) | number: '1.0-0' }}
            </div>
          </ng-container>
        </ng-template>
      </ng-container>
    </div>
  </div>
</div>
