<div *ngIf="character" class="plan-form-container">
  <app-item-view
    category="characters"
    [id]="info.id"
    [rarity]="info.rarity"
    [backgroundDeps]="info.element"
  ></app-item-view>
  <app-select
    class="attribute-select"
    [options]="constellations"
    [value]="progress.constellation"
    (changed)="setConstellation($event)"
  >
    <span form-label>
      {{ i18n.dict('constellation') | translate }}
      -
      {{ i18n.dict('constellations.' + info.id + '.name') | translate }}
    </span>
  </app-select>
  <app-curr-plan-level-select
    label="character"
    [currLevel]="progress"
    [planLevel]="plan"
    [reached]="reachedStates[1]"
    (executePlan)="executePlan.emit(1)"
    (currChange)="setCurrLevel($event)"
    (planChange)="setPlanLevel($event)"
  >
  </app-curr-plan-level-select>
  <ng-container
    *ngFor="let type of service.getStatsTypes(character); let i = index"
  >
    <app-curr-plan-comparator
      *ngIf="type.endsWith('%'); else numeric"
      [curr]="character.currentStats.get(type) | percent: '1.0-1'"
      [plan]="character.planStats.get(type) | percent: '1.0-1'"
    >
      {{ i18n.stats(type) | translate }}
    </app-curr-plan-comparator>
    <ng-template #numeric>
      <app-curr-plan-comparator
        [curr]="character.currentStats.get(type) | number: '1.0-0'"
        [plan]="character.planStats.get(type) | number: '1.0-0'"
      >
        {{ i18n.stats(type) | translate }}
      </app-curr-plan-comparator>
    </ng-template>
  </ng-container>
  <app-curr-plan-select
    *ngFor="let talent of info.talentsUpgradable; let i = index"
    [currOptions]="currTalentLevels[talent]"
    [planOptions]="planTalentLevels[talent]"
    [curr]="progress.talents[talent] || 1"
    [plan]="plan.talents[talent] || 1"
    (currChange)="setCurrTalent(talent, $event)"
    (planChange)="setPlanTalent(talent, $event)"
    [reached]="reachedStates[2 + i]"
    (executePlan)="executePlan.emit(2 + i)"
  >
    {{ i18n.dict('talent-types.' + (talent % 10)) | translate }}
    -
    {{ i18n.dict('talents.' + talent) | translate }}
  </app-curr-plan-select>
  <div *ngFor="let bonus of info.expBonus || []">
    {{ i18n.module('exp-bonus') | translate: bonus }}
  </div>
  <app-ring-button
    *ngIf="reachedStates.length > 0"
    class="execute-all-btn"
    [class.reached]="reachedStates[0]"
    [disabled]="!reachedStates[0]"
    (clicked)="executePlan.emit(0)"
  >
    {{ i18n.module('execute-all-plan') | translate }}
  </app-ring-button>
</div>
